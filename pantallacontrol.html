<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<title>Control Waikiki</title>
<style>
body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
input[type="color"], input[type="text"], select { margin: 10px; padding: 5px; height: 40px; cursor: pointer; }
input[type="text"] { width: 200px; }
</style>
</head>
<body>
<h2>Control de Pantalla Waikiki</h2>

<label>Selecciona un color:</label>
<input type="color" id="colorPicker">
<button onclick="sendColor()">Enviar color</button>
<br>

<button onclick="sendAleatori()">Color Aleatori</button>
<br>

<label>Selecciona un fitxer:</label>
<input type="file" id="fileInput" accept="image/*,video/*" onchange="sendFile()">
<p>Només mostra fitxers locals seleccionats</p>
<br>

<button onclick="sendMode('mode_logo')">Mostrar Logo</button>
<br>
<br>

<!-- Visuals combobox i botó Go -->
<label>Visualls:</label>
<br>
<select id="visualsSelect">
    <option value="">--Selecciona un visual--</option>
    <option value="https://github.com/gsolerf/Waikiki/raw/main/media/visual2.mp4">Visual 2</option>
    <option value="https://github.com/gsolerf/Waikiki/raw/main/media/visual3.gif">Visual 3</option>
    <option value="https://github.com/gsolerf/Waikiki/raw/main/media/visual4.mp4">Visual 4</option>
    <option value="https://github.com/gsolerf/Waikiki/raw/main/media/Jump.gif">Jump</option>
    <option value="https://github.com/gsolerf/Waikiki/raw/main/media/Logo.jpeg">Logo</option>
</select>
<button onclick="goVisual()">Go</button>
<br>
<br>

<label>Text per mostrar:</label>
<input type="text" id="textInput" placeholder="Escriu text aquí">
<button onclick="sendText()">Enviar text</button>
<button onclick="clearText()">Borrar text</button>
<br>

<label>Modes dinàmics:</label><br>
<button onclick="sendMode('mode1')">Mode 1: Ritme del grup</button>
<button onclick="sendMode('mode2')">Mode 2: Flash aleatori</button>
<button onclick="sendMode('mode3')">Mode 3: Pastel calm</button>
<button onclick="sendMode('mode4')">Mode 4: Rainbow express</button>
<button onclick="sendMode('mode5')">Mode 5: Degradat improvisat</button>

<script>
const ws = new WebSocket("wss://waikiki.onrender.com/ws");

ws.onopen = () => console.log("Control connectat");
ws.onclose = () => console.log("Control desconnectat");
ws.onerror = (e) => console.error("Error control WS:", e);

// Estat local per enviar complet
let estat = {
    mode: "color",
    color: "#000000",
    text: "",
    media: ""
};

function enviarEstat() {
    ws.send(JSON.stringify(estat));
}

function sendColor() {
    estat.mode = "color";
    estat.color = document.getElementById("colorPicker").value;
    estat.media = "";
    enviarEstat();
}

function sendAleatori() {
    estat.mode = "color";
    const colors = ["#FF1493","#1E90FF","#FFD700"];
    estat.color = colors[Math.floor(Math.random()*colors.length)];
    estat.media = "";
    enviarEstat();
}

async function sendFile() {
    const file = document.getElementById("fileInput").files[0];
    if(!file) return;

    const formData = new FormData();
    formData.append("file", file);

    try {
        const res = await fetch("https://waikiki.onrender.com/upload", {
            method: "POST",
            body: formData
        });
        const data = await res.json();
        estat.mode = file.type.startsWith("video") ? "video" : "imatge";
        estat.media = data.url;
        enviarEstat();
    } catch(err) {
        console.error("Error pujant fitxer:", err);
    }
}

function sendText() {
    estat.text = document.getElementById("textInput").value.trim();
    enviarEstat();
}

function clearText() {
    estat.text = "";
    enviarEstat();
}

function sendMode(mode) {
    estat.mode = mode;
    estat.media = "";
    enviarEstat();
}

// Funció Go per a visuals
function goVisual() {
    const select = document.getElementById("visualsSelect");
    const url = select.value;
    if(!url) return;

    estat.mode = "mode_visual";
    estat.media = url;
    enviarEstat();
}
</script>
</body>
</html>
