<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<title>Control Waikiki</title>
<style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
    input[type="color"] { margin: 10px; padding: 5px; height: 40px; width: 80px; cursor: pointer; }
</style>
</head>
<body>
<h2>Control de Pantalla Waikiki</h2>

<label>Selecciona un color:</label>
<input type="color" id="colorPicker">
<button onclick="sendColor()">Enviar color</button>
<br>

<button onclick="sendAleatori()">Color Aleatori (blau, rosa, groc)</button>
<br>

<label>Selecciona un fitxer:</label>
<input type="file" id="fileInput" accept="image/*,video/*" onchange="sendFile()">
<p>Nota: Només mostra fitxers locals seleccionats</p>

<p>Estat actual: <span id="estatActual">---</span></p>

<script>
const ws = new WebSocket("wss://waikiki.onrender.com/ws");

// Mostrar connectivitat
ws.onopen = () => console.log("Control connectat");
ws.onclose = () => console.log("Control desconnectat");
ws.onerror = (e) => console.error("Error control WS:", e);

// Mostrar l'estat rebut del servidor
ws.onmessage = (event) => {
    console.log("Missatge rebut control:", event.data);
    try {
        const data = JSON.parse(event.data);
        document.getElementById("estatActual").innerText = JSON.stringify(data);
    } catch(e) {
        console.error("Error parsejant missatge:", e);
    }
};

// Enviar color seleccionat
function sendColor() {
    const color = document.getElementById("colorPicker").value;
    ws.send(JSON.stringify({type:"color", value: color}));
}

// Enviar color aleatori potent (blau, rosa, groc)
function sendAleatori() {
    ws.send(JSON.stringify({type:"aleatori"}));
}

// Enviar fitxer seleccionat (només URL local, no puja al servidor)
function sendFile() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) return;
    const url = URL.createObjectURL(file);
    const type = file.type.startsWith("video") ? "video" : "imatge";
    ws.send(JSON.stringify({type: type, url: url}));
}
</script>
</body>
</html>
